# スコア算出方法論

このドキュメントでは、O2CONNECTIVE適性診断サービスにおけるスコアの算出方法を説明します。

## 概要

本サービスでは、**多層スコア変換パイプライン**を採用しています。回答の生データから最終的な表示スコアまで、複数の変換ステップを経ることで、解釈しやすく、かつバイアスを軽減したスコアを提供します。

```
生スコア (1.0-5.0)
    ↓
Z-score（標準化）
    ↓
T-score（平均50, SD10）
    ↓
パーセンタイル（1-99）
    ↓
傾向レベル（5段階カテゴリ）
    ↓
自然言語記述
```

---

## 1. 生スコア (Raw Score)

### 算出方法

各ドメイン（性格特性）について、関連する設問の回答を集計します。

```
生スコア = 回答値の合計 / 設問数
```

- **回答値**: 1〜5（リカートスケール）
  - 1: 強くあてはまらない
  - 2: あてはまらない
  - 3: どちらともいえない
  - 4: あてはまる
  - 5: 強くあてはまる

### 逆転項目の処理

一部の設問は「逆転項目」として設計されています。逆転項目では、回答値を反転してから集計します。

```
反転後の値 = 6 - 元の回答値
```

例: 回答が5の場合 → 6 - 5 = 1

### 算出例

外向性（EX）の設問が10問あり、回答が以下の場合：
- 通常項目6問: [4, 3, 4, 5, 3, 4] → 合計23
- 逆転項目4問: [2, 3, 2, 2] → 反転後 [4, 3, 4, 4] → 合計15

```
生スコア = (23 + 15) / 10 = 3.8
```

---

## 2. Z-score（標準化スコア）

### 目的

生スコアを母集団の分布に基づいて標準化します。これにより、異なるドメイン間での比較が可能になります。

### 算出式

```
Z-score = (生スコア - 母集団平均) / 母集団標準偏差
```

### 母集団統計値

本サービスでは、以下の母集団統計値を使用しています（IPIP-NEO研究に基づく推定値）：

| ドメイン | 母集団平均 | 母集団SD |
|----------|-----------|----------|
| 外向性 (EX) | 3.0 | 0.8 |
| 誠実性 (CO) | 3.5 | 0.7 |
| 協調性 (AG) | 3.7 | 0.6 |
| 情緒安定性 (NE) | 3.0 | 0.8 |
| 開放性 (OP) | 3.5 | 0.7 |
| マキャベリズム (MA) | 2.8 | 0.7 |
| ナルシシズム (NA) | 2.9 | 0.7 |
| サイコパシー (PS) | 2.3 | 0.6 |
| 共感性 (EM) | 3.5 | 0.7 |
| 仕事への姿勢 (WR) | 3.3 | 0.7 |
| 回答信頼性 (LI) | 3.0 | 0.5 |

### 算出例

外向性の生スコアが3.8の場合：
```
Z-score = (3.8 - 3.0) / 0.8 = 1.0
```

---

## 3. T-score

### 目的

Z-scoreを、より直感的に理解しやすい尺度に変換します。T-scoreは平均50、標準偏差10の分布を持ちます。

### 算出式

```
T-score = 50 + (Z-score × 10)
```

### 制限

T-scoreは20〜80の範囲にクリップされます。

### 算出例

Z-scoreが1.0の場合：
```
T-score = 50 + (1.0 × 10) = 60
```

### T-scoreの解釈

| T-score範囲 | 解釈 |
|------------|------|
| 65以上 | 非常に特徴的（上位約7%） |
| 55-64 | 特徴的（上位約31%） |
| 45-54 | 中程度（中央約38%） |
| 35-44 | やや控えめ（下位約31%） |
| 35未満 | 控えめ（下位約7%） |

---

## 4. パーセンタイル

### 目的

T-scoreを、母集団内での相対的な位置として表現します。

### 算出式

パーセンタイルは、正規分布の累積分布関数（CDF）を使用して算出します。

```
パーセンタイル = Φ(Z-score) × 100
```

ここで、Φは標準正規分布の累積分布関数です。

### 近似計算

本サービスでは、以下の近似式を使用しています：

```javascript
function normalCDF(z) {
  const a1 = 0.254829592;
  const a2 = -0.284496736;
  const a3 = 1.421413741;
  const a4 = -1.453152027;
  const a5 = 1.061405429;
  const p = 0.3275911;

  const sign = z < 0 ? -1 : 1;
  z = Math.abs(z) / Math.sqrt(2);

  const t = 1.0 / (1.0 + p * z);
  const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-z * z);

  return 0.5 * (1.0 + sign * y);
}
```

### 算出例

Z-scoreが1.0の場合：
```
パーセンタイル = Φ(1.0) × 100 ≈ 84
```
（母集団の84%がこのスコア以下）

---

## 5. 傾向レベル（Tendency Level）

### 目的

T-scoreを、5段階のカテゴリカルな表現に変換します。これにより、数値を直感的に理解しやすくなります。

### 変換ルール

| T-score | 傾向レベル | 日本語表現 |
|---------|-----------|-----------|
| 65以上 | very_characteristic | 非常に特徴的 |
| 55-64 | characteristic | 特徴的 |
| 45-54 | moderate | 中程度 |
| 35-44 | less_characteristic | やや控えめ |
| 35未満 | not_characteristic | 控えめ |

---

## 6. 自然言語記述

### 目的

傾向レベルを、各ドメインの文脈に合った自然な日本語表現に変換します。

### 例：外向性（EX）

| 傾向レベル | 記述 |
|-----------|------|
| very_characteristic | 社交的な場面でエネルギーを得やすい傾向が非常に強い |
| characteristic | 人との交流を楽しむ傾向がある |
| moderate | 状況に応じて社交性を発揮する |
| less_characteristic | 一人の時間も大切にする傾向がある |
| not_characteristic | 静かな環境でエネルギーを充電しやすい |

---

## 回答信頼性指標（LI）

### 目的

回答の一貫性と信頼性を評価します。

### 算出方法

1. **社会的望ましさバイアス**: LIドメインの生スコアを評価
2. **回答パターンの一貫性**: 類似設問への回答の整合性を確認

### 信頼性ステータス

| LI T-score | ステータス | 解釈 |
|------------|-----------|------|
| 55以上 | high | 一貫性のある回答パターン |
| 45-54 | moderate | 標準的な回答パターン |
| 45未満 | low | 回答にばらつきがある可能性 |

---

## 認知能力テスト（ICAR-16）のスコア算出

### 生スコア

```
生スコア = 正答数 / 総問題数 × 16
```

### 標準スコア（IQ形式）

認知能力テストでは、平均100、標準偏差15の尺度を使用します。

```
標準スコア = 100 + (Z-score × 15)
```

### パーセンタイル

性格診断と同様に、正規分布のCDFを使用して算出します。

### 認知レベル

| 標準スコア | レベル |
|-----------|--------|
| 115以上 | significantly_above_average（非常に高い） |
| 100-114 | above_average（高い） |
| 85-99 | average（平均） |
| 70-84 | below_average（低め） |
| 70未満 | significantly_below_average（低い） |

---

## 参考文献

1. IPIP-NEO Personality Inventory (https://ipip.ori.org/)
2. ICAR: International Cognitive Ability Resource (https://icar-project.com/)
3. Big Five Model of Personality

---

## 実装ファイル

- スコア変換: `app/src/services/ScoreTransformer.ts`
- 認知テストスコア: `app/src/services/CognitiveScoring.ts`
- 型定義: `app/src/types/assessment.ts`
